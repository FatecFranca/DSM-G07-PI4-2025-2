<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Documentação da API - Gestão de Energia</title>

    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            background: #121212;
            margin: 0;
            padding: 0 20px;
            color: #fff;
        }

        header {
            background: #1f1f1f;
            padding: 20px;
            margin: 0 -20px;
            text-align: center;
            border-bottom: 2px solid #333;
        }

        h1 {
            margin: 0;
            font-size: 26px;
        }

        h2 {
            margin-top: 40px;
            border-left: 4px solid #4caf50;
            padding-left: 10px;
        }

        .endpoint {
            background: #1e1e1e;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #333;
        }

        .method {
            font-weight: bold;
            padding: 4px 10px;
            border-radius: 4px;
            color: #fff;
            font-size: 13px;
        }

        .GET { background: #2962ff; }
        .POST { background: #2e7d32; }
        .PUT { background: #ff8f00; }
        .DELETE { background: #d32f2f; }

        .code-container {
            position: relative;
            margin-top: 20px;
            border: 1px solid #444;
            border-radius: 6px;
            background: #111;
            padding: 15px;
        }

        .status-badge {
            position: absolute;
            top: 10px;
            right: 12px;
            color: #fff;
            padding: 5px 12px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 12px;
        }

        .success { background: #4caf50; }
        .created { background: #2e7d32; }
        .error { background: #e53935; }
        .warning { background: #ffb300; }

        .response-title {
            margin-top: 25px;
            margin-bottom: 10px;
            font-weight: bold;
            color: #fff;
        }

        pre {
            margin: 0;
            overflow-x: auto;
        }

        code {
            color: #9ccc65;
            font-size: 14px;
        }

        .token-note {
            margin-top: 10px;
            padding: 10px;
            background: #263238;
            border-left: 4px solid #4caf50;
            border-radius: 6px;
            font-size: 14px;
        }
    </style>
</head>

<body>
    <header>
        <h1> Documentação da API — Gestão de Energia</h1>
    </header>

    <h2>1. Autenticação</h2>

    <div class="endpoint">
        <span class="method POST">POST</span> /api/auth/register
        <p>Cria um novo usuário na plataforma.</p>

        <strong>Body (JSON):</strong>
        <div class="code-container">
<pre><code>{
  "fullName": "Ana Souza",
  "email": "ana@email.com",
  "password": "123456"
}
</code></pre>
        </div>

        <div class="response-title">Resposta:</div>
        <div class="code-container">
            <span class="status-badge created">201</span>
<pre><code>{
  "user": {
    "id": 3,
    "email": "ana@email.com",
    "nome": "Ana Souza"
  },
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
</code></pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method POST">POST</span> /api/auth/login
        <p>Autentica o usuário e retorna um token JWT.</p>

        <strong>Body:</strong>
        <div class="code-container">
<pre><code>{
  "email": "ana@email.com",
  "password": "123456"
}
</code></pre>
        </div>

        <div class="response-title">Resposta:</div>
        <div class="code-container">
            <span class="status-badge success">200</span>
<pre><code>{
  "user": {
    "id": 3,
    "email": "ana@email.com",
    "nome": "Ana Souza"
  },
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
</code></pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method GET">GET</span> /api/auth/me
        <p>Retorna os dados do usuário autenticado atual.</p>
        
        <div class="token-note">
            Requer Header: <code>Authorization: Bearer SEU_TOKEN</code>
        </div>

        <div class="response-title">Resposta:</div>
        <div class="code-container">
            <span class="status-badge success">200</span>
<pre><code>{
  "user": {
    "id": 3,
    "email": "ana@email.com",
    "nome": "Ana Souza"
  }
}
</code></pre>
        </div>
    </div>

    <h2>2. Dispositivos</h2>

    <div class="token-note">
        <strong>Atenção:</strong> Todas as requisições abaixo exigem token JWT.<br>
        <code>Authorization: Bearer SEU_TOKEN_AQUI</code>
    </div>

    <div class="endpoint">
        <span class="method POST">POST</span> /api/devices
        <p>Cria um dispositivo associado ao usuário logado. O código de identificação é gerado automaticamente (ex: REL001).</p>

        <strong>Body:</strong>
        <div class="code-container">
<pre><code>{
  "name": "Medidor da Sala",
  "property_address": "Rua A, 123"
}
</code></pre>
        </div>

        <div class="response-title">Resposta:</div>
        <div class="code-container">
            <span class="status-badge created">201</span>
<pre><code>{
  "name": "Medidor da Sala",
  "identification_code": "REL002",
  "property_address": "Rua A, 123"
}
</code></pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method GET">GET</span> /api/devices
        <p>Retorna todos os dispositivos do usuário autenticado.</p>

        <div class="code-container">
            <span class="status-badge success">200</span>
<pre><code>[
  {
    "id": 3,
    "name": "Medidor da Sala",
    "identification_code": "REL002",
    "property_address": "Rua A, 123",
    "consumo_iot": 150.50
  }
]
</code></pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method GET">GET</span> /api/devices/:id
        <p>Retorna um dispositivo específico pelo ID.</p>

        <div class="code-container">
            <span class="status-badge success">200</span>
<pre><code>{
  "id": 3,
  "name": "Medidor da Sala",
  "identification_code": "REL002",
  "property_address": "Rua A, 123",
  "consumo_iot": 150.50
}
</code></pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method PUT">PUT</span> /api/devices/3
        <p>Atualiza os dados de um dispositivo.</p>

        <strong>Body:</strong>
        <div class="code-container">
<pre><code>{
  "name": "Medidor da Sala (Atualizado)",
  "property_address": "Rua das Couves, 50"
}
</code></pre>
        </div>

        <div class="response-title">Resposta:</div>
        <div class="code-container">
            <span class="status-badge success">200</span>
<pre><code>{
  "id": 3,
  "name": "Medidor da Sala (Atualizado)",
  "identification_code": "REL002",
  "property_address": "Rua das Couves, 50"
}
</code></pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method DELETE">DELETE</span> /api/devices/3
        <p>Remove um dispositivo.</p>

        <div class="code-container">
            <span class="status-badge success">200</span>
<pre><code>{
  "message": "Dispositivo deletado com sucesso!"
}
</code></pre>
        </div>
    </div>

    <h2>3. Faturas</h2>

    <div class="token-note">
        <strong>Atenção:</strong> Todas as rotas de faturas exigem o token JWT no header.
    </div>

    <div class="endpoint">
        <span class="method POST">POST</span> /api/bills
        <p>Cria uma fatura para um dispositivo. O sistema adicionará automaticamente 1 mês à data enviada (lógica de fechamento).</p>

        <strong>Body:</strong>
        <div class="code-container">
<pre><code>{
  "device_id": 4,
  "month_year": "2024-09",
  "company_consumption_kwh": 300,
  "real_consumption_kwh": 280,
  "consumo_iot": 275.5,
  "amount_paid": 200.75,
  "price_per_kwh": 0.65
}
</code></pre>
        </div>
        <p><strong>Campos Obrigatórios:</strong> device_id, month_year, company_consumption_kwh, amount_paid, price_per_kwh.</p>

        <div class="response-title">Resposta:</div>
        <div class="code-container">
            <span class="status-badge created">201</span>
<pre><code>{
  "id": 3,
  "device_id": 4,
  "month_year": "2024-10", 
  "company_consumption_kwh": 300,
  "real_consumption_kwh": 280,
  "consumo_iot": 275.5,
  "amount_paid": 200.75,
  "price_per_kwh": 0.65,
  "device": {
    "id": 4,
    "name": "Medidor da Sala",
    "identification_code": "REL002"
  }
}
</code></pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method GET">GET</span> /api/bills
        <p>Lista todas as faturas do usuário autenticado.</p>

        <div class="code-container">
            <span class="status-badge success">200</span>
<pre><code>[
  {
    "id": 3,
    "device_id": 4,
    "month_year": "2024-10",
    "company_consumption_kwh": 300,
    "amount_paid": 200.75,
    "device": {
      "id": 4,
      "name": "Medidor da Sala",
      "identification_code": "REL002"
    }
  }
]
</code></pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method PUT">PUT</span> /api/bills/3
        <p>Edita uma fatura já cadastrada.</p>

        <strong>Body:</strong>
        <div class="code-container">
<pre><code>{
  "amount_paid": 210.50,
  "month_year": "2024-09"
}
</code></pre>
        </div>

        <div class="response-title">Resposta:</div>
        <div class="code-container">
            <span class="status-badge success">200</span>
<pre><code>{
  "id": 3,
  "device_id": 4,
  "month_year": "2024-10",
  "amount_paid": 210.50,
  "company_consumption_kwh": 300,
  "device": {
    "id": 4,
    "name": "Medidor da Sala",
    "identification_code": "REL002"
  }
}
</code></pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method DELETE">DELETE</span> /api/bills/3
        <p>Remove uma fatura.</p>

        <div class="code-container">
            <span class="status-badge success">200</span>
<pre><code>{
  "message": "Fatura deletada com sucesso!"
}
</code></pre>
        </div>
    </div>

    <h2>4. Dashboard</h2>

    <div class="token-note">
        <strong>Atenção:</strong> Todas as rotas de dashboard exigem token JWT.
    </div>

    <div class="endpoint">
        <span class="method GET">GET</span> /api/dashboard
        <p>Retorna os dados brutos das faturas para o dashboard.</p>

        <div class="code-container">
            <span class="status-badge success">200</span>
<pre><code>{
  "bills": [
    {
      "id": 1,
      "device_id": 1,
      "month_year": "2025-07",
      "company_consumption_kwh": 300,
      "amount_paid": 180,
      "device": {
        "id": 1,
        "name": "Carregador Iphone",
        "identification_code": "REL001"
      }
    }
  ]
}
</code></pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method GET">GET</span> /api/dashboard/analytics
        <p>Retorna análises estatísticas calculadas baseadas no consumo IoT das faturas do usuário.</p>

        <div class="code-container">
            <span class="status-badge success">200</span>
<pre><code>{
  "distribuicao_dispositivos": [
    {
      "device": "Medidor da Sala",
      "percentual": 45.5
    }
  ],
  "media": {
    "geral": 250.50,
    "por_dispositivo": [
      {
        "device_id": 1,
        "device_name": "Medidor da Sala",
        "media": 250.50
      }
    ]
  },
  "desvio_padrao": 45.23,
  "distribuicao_normal": {
    "media": 250.50,
    "desvio": 45.23
  },
  "correlacao": {
    "consumo_estimado_iot": 0.85,
    "iot_valor": 0.92
  },
  "regressao": {
    "a": 0.65,
    "b": 10.5,
    "r2": 0.85
  }
}
</code></pre>
        </div>
        <p><strong>Descrição dos campos:</strong></p>
        <ul>
            <li><strong>distribuicao_dispositivos</strong>: Distribuição percentual do consumo IoT por dispositivo</li>
            <li><strong>media.geral</strong>: Média geral do valor das faturas</li>
            <li><strong>media.por_dispositivo</strong>: Média do valor das faturas agrupada por dispositivo</li>
            <li><strong>desvio_padrao</strong>: Desvio padrão dos valores pagos</li>
            <li><strong>distribuicao_normal</strong>: Parâmetros da distribuição normal (média e desvio padrão)</li>
            <li><strong>correlacao</strong>: Correlações de Pearson entre consumos e valores</li>
            <li><strong>regressao</strong>: Regressão linear (y = ax + b) entre consumo IoT e valor pago</li>
        </ul>
    </div>

    <div class="endpoint">
        <span class="method GET">GET</span> /api/dashboard/media-geral
        <p>Retorna apenas a média geral do valor de todas as faturas do usuário.</p>

        <div class="code-container">
            <span class="status-badge success">200</span>
<pre><code>{
  "mediaGeral": 250.50
}
</code></pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method GET">GET</span> /api/dashboard/desvio-padrao
        <p>Retorna apenas o desvio padrão do valor das faturas.</p>

        <div class="code-container">
            <span class="status-badge success">200</span>
<pre><code>{
  "desvioPadrao": 45.23
}
</code></pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method GET">GET</span> /api/dashboard/probabilidade-proximo-mes
        <p>Calcula a probabilidade da próxima fatura estar entre dois valores (min e max).</p>

        <strong>Query Parameters:</strong>
        <div class="code-container">
<pre><code>?min=200&max=300
</code></pre>
        </div>

        <div class="response-title">Resposta:</div>
        <div class="code-container">
            <span class="status-badge success">200</span>
<pre><code>{
  "probabilidadeProximoMes": 72.50
}
</code></pre>
        </div>
        <p>Retorna a porcentagem de probabilidade baseada na distribuição normal dos dados históricos.</p>
    </div>

    <div class="token-note" style="margin-top: 40px; padding: 15px;">
        <strong>Observação Geral:</strong><br>
        O token deve ser enviado no formato <code>Bearer &lt;token&gt;</code> no header <code>Authorization</code>.
    </div>

</body>
</html>